# From the below question, we get to know that how to create a LVM from Ansible playbook.

### Question: Create a lvm and below tasks must be fullfill.

    - Create a play for this task with named `mylvm.yaml` under `/home/student/ansible` directory.
    - Create a Volume Group (VG) with named `firefly
    - Create a LVM with name `firefly` under the VolumeGroup named `firefly`.
    - Size of LVM should be `512 Mib`
    - Filesystem of this LVM should ext4.
    - Must use the `/dev/vdb` disk.
---


## Solution: 
### We can take the reference from the below documentation. 
```
ansible-doc community.general.lvol
ansible-doc community.general.filesystem
```



### Login into your managed node and check which partition is free. For me, I can see that its `vdb` is free.
```
[root@workstation ~]# ssh servera -l root

[root@servera ~]# lsblk -fs
NAME  FSTYPE FSVER LABEL UUID                                 FSAVAIL FSUSE% MOUNTPOINTS
vda1                                                                         
└─vda                                                                        
vda2  vfat   FAT16       7B77-95E7                             192.8M     3% /boot/efi
└─vda                                                                        
vda3  xfs          boot  5e75a2b9-1367-4cc8-bb38-4d6abc3964b8  334.7M    32% /boot
└─vda                                                                        
vda4  xfs          root  fb535add-9799-4a27-b8bc-e8259f39a767    7.6G    19% /
└─vda                                                                        
vdb   <-------  This partition is free.
[root@servera ~]# 
```

### Next, log off from the managed node, and login back to your Ansible host machine. For me, its workstation.



```
vim mylvm.yaml
```
```
---
- name: Create LVM, volume group, and ext4 filesystem on /dev/vdb without command module
  hosts: all
  become: true
  gather_facts: true
  tasks:
    - name: Create volume group firefly on /dev/vdb
      community.general.lvg:
        vg: firefly
        pvs: /dev/vdb

    - name: Create logical volume firefly
      community.general.lvol:
        vg: firefly
        lv: firefly
        size: 512m

    - name: Create ext4 filesystem on logical volume
      ansible.builtin.filesystem:
        fstype: ext4
        dev: /dev/firefly/firefly
```


### Run the playbook.
```
 ansible-navigator run mylvm.yaml -m stdout
```

### Post checks.
```
ansible servera -m shell -a 'vgdisplay'
 ```
```
ansible servera -m shell -a 'lvdisplay'
```


[student@workstation ansible]$ ansible-navigator run mylvm.yaml -m stdout

PLAY [Create LVM, volume group, and ext4 filesystem on /dev/vdb without command module] ***

TASK [Gathering Facts] *********************************************************
ok: [serverb]
ok: [serverc]
ok: [serverd]
ok: [servera]

TASK [Create volume group firefly on /dev/vdb] *********************************
ok: [serverb]
ok: [serverd]
ok: [serverc]
ok: [servera]

TASK [Create logical volume firefly] *******************************************
ok: [servera]
ok: [serverb]
ok: [serverd]
ok: [serverc]

TASK [Create ext4 filesystem on logical volume] ********************************
ok: [serverb]
ok: [serverd]
ok: [servera]
ok: [serverc]

PLAY RECAP *********************************************************************
servera                    : ok=4    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
serverb                    : ok=4    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
serverc                    : ok=4    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
serverd                    : ok=4    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
[student@workstation ansible]$ 



[student@workstation ansible]$ ansible servera -m shell -a 'lvdisplay'
servera | CHANGED | rc=0 >>
  --- Logical volume ---
  LV Path                /dev/firefly/firefly
  LV Name                firefly
  VG Name                firefly
  LV UUID                EcNKMA-pTiL-fsJi-t8eP-hPFd-vJ4H-s6bX05
  LV Write Access        read/write
  LV Creation host, time servera.lab.example.com, 2025-10-14 05:43:42 -0400
  LV Status              available
  # open                 0
  LV Size                512.00 MiB
  Current LE             128
  Segments               1
  Allocation             inherit
  Read ahead sectors     auto
  - currently set to     8192
  Block device           253:0
   
[student@workstation ansible]$ ansible servera -m shell -a 'vgdisplay'
servera | CHANGED | rc=0 >>
  --- Volume group ---
  VG Name               firefly
  System ID             
  Format                lvm2
  Metadata Areas        1
  Metadata Sequence No  2
  VG Access             read/write
  VG Status             resizable
  MAX LV                0
  Cur LV                1
  Open LV               0
  Max PV                0
  Cur PV                1
  Act PV                1
  VG Size               1020.00 MiB
  PE Size               4.00 MiB
  Total PE              255
  Alloc PE / Size       128 / 512.00 MiB
  Free  PE / Size       127 / 508.00 MiB
  VG UUID               neNYxg-p1Mh-EnAs-1ENU-Ni2N-KKsB-KcxdKr
   
[student@workstation ansible]$ 
```
